
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Google Maps Style Photo Card Maker</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Roboto:wght@400;500;700&family=Outfit:wght@500&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
      body {
        font-family: 'Roboto', 'Noto Sans KR', sans-serif;
        background-color: #f3f4f6;
        overscroll-behavior: none;
      }
      /* Hide scrollbar */
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      /* Custom Animations */
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-fade-in {
        animation: fadeIn 0.3s ease-out forwards;
      }
      
      /* Toggle Switch CSS */
      .toggle-checkbox:checked {
        right: 0;
        border-color: #1a73e8;
      }
      .toggle-checkbox:checked + .toggle-label {
        background-color: #1a73e8;
      }
    </style>

    <!-- Import Map for React modules -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "html-to-image": "https://esm.sh/html-to-image@1.11.11"
      }
    }
    </script>
  </head>
  <body>
    <div id="root"></div>

    <!-- Main Application Code -->
    <script type="text/babel" data-presets="react,typescript" data-type="module">
      import React, { useState, useRef, useEffect } from 'react';
      import { createRoot } from 'react-dom/client';
      import { toPng, toBlob } from 'html-to-image';

      // --- Icons ---
      const Icons = {
        Back: () => (
          <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="white">
            <path d="M0 0h24v24H0z" fill="none"/><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
          </svg>
        ),
        More: () => (
          <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="white">
            <path d="M0 0h24v24H0z" fill="none"/><path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
          </svg>
        ),
        ShareWhite: () => (
          <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="white">
            <path d="M0 0h24v24H0z" fill="none"/><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>
          </svg>
        ),
        Share: ({ color = "#3c4043" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20" fill={color}>
            <path d="M0 0h24v24H0z" fill="none"/><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>
          </svg>
        ),
        Bookmark: ({ color = "#3c4043" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill={color}>
            <path d="M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z"/>
          </svg>
        ),
        Close: ({ color = "#3c4043" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="none" stroke={color} strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
            <path d="M6 18L18 6M6 6l12 12" />
          </svg>
        ),
        StarFull: () => (
          <svg xmlns="http://www.w3.org/2000/svg" height="14" viewBox="0 0 24 24" width="14" fill="#FBC02D">
            <path d="M0 0h24v24H0z" fill="none"/><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
          </svg>
        ),
        StarEmpty: ({ color = "#E0E0E0" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" height="14" viewBox="0 0 24 24" width="14" fill={color}>
            <path d="M0 0h24v24H0z" fill="none"/><path d="M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"/>
          </svg>
        ),
        Direction: () => (
          <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20" fill="white">
            <path d="M0 0h24v24H0z" fill="none"/><path d="M21.71 11.29l-9-9c-.39-.39-1.02-.39-1.41 0l-9 9c-.39.39-.39 1.02 0 1.41l9 9c.39.39 1.02.39 1.41 0l9-9c.39-.38.39-1.01 0-1.41zM14 14.5V12h-4v3H8v-4c0-.55.45-1 1-1h5V7.5l3.5 3.5-3.5 3.5z"/>
          </svg>
        ),
        Navigation: ({ color = "#1a73e8" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20" fill={color}>
            <path d="M0 0h24v24H0z" fill="none"/><path d="M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"/>
          </svg>
        ),
        Save: ({ color = "#1a73e8", stroke = "#1a73e8" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20" fill="none">
            <path d="M0 0h24v24H0z" fill="none"/><path d="M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z" stroke={stroke} strokeWidth="2"/>
          </svg>
        ),
        Flag: ({ color = "#1a73e8" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20" fill={color}>
             <path d="M0 0h24v24H0z" fill="none"/><path d="M14.4 6L14 4H5v17h2v-7h5.6l.4 2h7V6z"/>
          </svg>
        ),
        GoogleLogo: () => (
          <span className="text-white/80 text-[22px] whitespace-nowrap select-none" style={{ fontFamily: 'Outfit, sans-serif', textShadow: '0 2px 4px rgba(0,0,0,0.5)', fontWeight: 500 }}>
            Google Maps
          </span>
        ),
        ZoomIn: () => (
          <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20" fill="white">
            <path d="M0 0h24v24H0z" fill="none"/><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
          </svg>
        ),
        ZoomOut: () => (
          <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20" fill="white">
            <path d="M0 0h24v24H0z" fill="none"/><path d="M19 13H5v-2h14v2z"/>
          </svg>
        ),
        BlueCheck: () => (
           <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM10 17L5 12L6.41 10.59L10 14.17L17.59 6.58L19 8L10 17Z" fill="#1DA1F2"/>
           </svg>
        ),
        Moon: () => (
          <svg xmlns="http://www.w3.org/2000/svg" height="16" viewBox="0 0 24 24" width="16" fill="currentColor">
            <path d="M0 0h24v24H0z" fill="none"/><path d="M10 2c-1.82 0-3.53.5-5 1.35C7.99 5.08 10 8.3 10 12s-2.01 6.92-5 8.65C6.47 21.5 8.18 22 10 22c5.52 0 10-4.48 10-10S15.52 2 10 2z"/>
          </svg>
        ),
        Sun: () => (
          <svg xmlns="http://www.w3.org/2000/svg" height="16" viewBox="0 0 24 24" width="16" fill="currentColor">
            <path d="M0 0h24v24H0z" fill="none"/><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm9-9.95h-2V3.5h2V.55zm7.45 3.91l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-3.21 13.7l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V19.5h-2v2.95zm-7.45-3.91l1.41 1.41 1.79-1.8-1.41-1.41-1.79 1.8z"/>
          </svg>
        )
      };

      // --- Modern Input Component ---
      const InputField = ({ label, value, onChange, maxLength, placeholder }) => {
        return (
          <div className="flex flex-col gap-1.5">
            <label className="text-xs font-semibold text-gray-500 ml-1">{label}</label>
            <input
              type="text"
              value={value}
              onChange={onChange}
              maxLength={maxLength}
              placeholder={placeholder}
              className="w-full h-12 px-4 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:bg-white focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all text-gray-900 placeholder-gray-400"
            />
          </div>
        );
      };

      // --- Fun Distance Units ---
      const distUnits = [
        'km', 'm', 'cm', 'mile', 'ft', 'yd', 
        'Í¥ëÎÖÑ(ly)', 'ÌååÏÑπ(pc)', 'AU(Ï≤úÎ¨∏Îã®ÏúÑ)', 
        'Í±∏Ïùå', 'Î∞îÎÇòÎÇò', 'ÏßÄÍµ¨ ÌïúÎ∞îÌÄ¥'
      ];

      const App = () => {
        // --- State Management ---
        const [isLoaded, setIsLoaded] = useState(false);
        const [image, setImage] = useState(null);
        const [imgScale, setImgScale] = useState(1.0);
        const [imgPos, setImgPos] = useState({ x: 0, y: 0 });
        
        // Form Data
        const [locationName, setLocationName] = useState('');
        const [rating, setRating] = useState('0.0');
        const [reviewCount, setReviewCount] = useState('');
        const [description, setDescription] = useState('');
        const [distValue, setDistValue] = useState('');
        const [distUnit, setDistUnit] = useState('km');
        
        // New Features State
        const [isVerified, setIsVerified] = useState(false);
        const [isDarkMode, setIsDarkMode] = useState(false);
        const [aspectRatio, setAspectRatio] = useState('9/16');

        const [isDownloading, setIsDownloading] = useState(false);
        const [isHidden, setIsHidden] = useState(false); // To hide image for UI capture
        
        const previewRef = useRef(null);
        const imgContainerRef = useRef(null);

        // Platform Detection (Robust iPad detection)
        const isIOS = (typeof navigator !== 'undefined') && (
            /iPad|iPhone|iPod/.test(navigator.userAgent) || 
            (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1)
        );

        useEffect(() => {
          const loadData = () => {
            try {
              const savedData = localStorage.getItem('googleMapsCardData');
              if (savedData) {
                const parsed = JSON.parse(savedData);
                if (parsed.locationName) setLocationName(parsed.locationName);
                if (parsed.rating) setRating(parsed.rating);
                if (parsed.reviewCount) setReviewCount(parsed.reviewCount);
                if (parsed.description) setDescription(parsed.description);
                if (parsed.distValue) setDistValue(parsed.distValue);
                if (parsed.distUnit) setDistUnit(parsed.distUnit);
                if (parsed.isVerified !== undefined) setIsVerified(parsed.isVerified);
                if (parsed.isDarkMode !== undefined) setIsDarkMode(parsed.isDarkMode);
                if (parsed.aspectRatio) setAspectRatio(parsed.aspectRatio);
              }
            } catch (e) {
              console.error("Failed to load local storage", e);
            }
            setIsLoaded(true);
          };
          loadData();
        }, []);

        useEffect(() => {
          if (isLoaded) {
            const dataToSave = {
              locationName, rating, reviewCount, description, 
              distValue, distUnit, isVerified, isDarkMode, aspectRatio
            };
            localStorage.setItem('googleMapsCardData', JSON.stringify(dataToSave));
          }
        }, [locationName, rating, reviewCount, description, distValue, distUnit, isVerified, isDarkMode, aspectRatio, isLoaded]);

        const compressImage = (file) => {
          return new Promise((resolve) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = (event) => {
              const img = new Image();
              img.src = event.target.result;
              img.onload = () => {
                const canvas = document.createElement('canvas');
                // Aggressive downscaling for iOS/iPad stability
                // Reduced from 1280 to prevent memory spikes on sharing
                const MAX_WIDTH = isIOS ? 1024 : 1920; 
                const MAX_HEIGHT = isIOS ? 1024 : 1920;
                let width = img.width;
                let height = img.height;

                if (width > height) {
                  if (width > MAX_WIDTH) {
                    height *= MAX_WIDTH / width;
                    width = MAX_WIDTH;
                  }
                } else {
                  if (height > MAX_HEIGHT) {
                    width *= MAX_HEIGHT / height;
                    height = MAX_HEIGHT;
                  }
                }
                
                canvas.width = width;
                canvas.height = height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, width, height);
                // Lower quality slightly for iOS
                resolve(canvas.toDataURL('image/jpeg', isIOS ? 0.7 : 0.8)); 
              };
            };
          });
        };

        const handleImageUpload = async (e) => {
          if (e.target.files && e.target.files[0]) {
            const resizedImage = await compressImage(e.target.files[0]);
            setImage(resizedImage);
            setImgScale(1.0);
            setImgPos({ x: 0, y: 0 });
          }
        };

        const handleRatingChange = (e) => {
          setRating(parseFloat(e.target.value).toFixed(1));
        };

        const handleReviewCountChange = (e) => {
          const rawValue = e.target.value.replace(/[^0-9]/g, '');
          if (rawValue) {
            setReviewCount(Number(rawValue).toLocaleString());
          } else {
            setReviewCount('');
          }
        };

        const handleDistChange = (e) => {
          const rawValue = e.target.value.replace(/[^0-9]/g, '');
          if (rawValue) {
            setDistValue(Number(rawValue).toLocaleString());
          } else {
            setDistValue('');
          }
        };

        // --- New Positioning Logic (3x3 Grid Buttons) ---
        // Offset value to shift the image by when clicking the grid
        const OFFSET = 200; 

        // x, y logic:
        // Center: 0, 0
        // Top Left: move image Down (+y) and Right (+x) to see top-left corner
        const handleAlign = (x, y) => {
            setImgPos({ x, y });
        };

        const handleZoomIn = () => {
          setImgScale(prev => Math.min(prev + 0.1, 5.0));
        };

        const handleZoomOut = () => {
          setImgScale(prev => Math.max(prev - 0.1, 0.2));
        };

        const loadImage = (src) => {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = "anonymous";
                img.onload = () => resolve(img);
                img.onerror = reject;
                img.src = src;
            });
        };

        const generateImage = async (format = 'blob') => {
            if (!previewRef.current || !image) return null;

            // Wait for fonts
            await document.fonts.ready;
            
            // Initial delay to let things settle
            await new Promise(resolve => setTimeout(resolve, isIOS ? 800 : 300));

            // Setup sizes
            const rect = previewRef.current.getBoundingClientRect();
            // Reduce target resolution for iOS to prevent memory crashes
            const targetWidth = isIOS ? 720 : 1080; 
            const targetHeight = Math.round(targetWidth * (rect.height / rect.width));
            
            // Retry logic loop
            let attempts = 0;
            const maxAttempts = 2;
            
            while (attempts < maxAttempts) {
                try {
                    const canvas = document.createElement('canvas');
                    canvas.width = targetWidth;
                    canvas.height = targetHeight;
                    const ctx = canvas.getContext('2d');

                    // 1. Fill Background
                    ctx.fillStyle = isDarkMode ? '#202124' : '#f3f4f6';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    // 2. Draw Background Image Manually
                    // This avoids foreignObject issues on iOS with large images
                    try {
                        const loadedImg = await loadImage(image);
                        const scaleRatio = targetWidth / rect.width;
                        
                        ctx.save();
                        // Translate to center of canvas
                        ctx.translate(canvas.width / 2, canvas.height / 2);
                        // Translate by user's position adjustment (scaled)
                        ctx.translate(imgPos.x * scaleRatio, imgPos.y * scaleRatio);
                        // Scale
                        ctx.scale(imgScale, imgScale);
                        // Draw image centered at origin
                        ctx.drawImage(loadedImg, -loadedImg.width / 2, -loadedImg.height / 2);
                        ctx.restore();
                    } catch (err) {
                        console.error("Failed to draw background image", err);
                    }

                    // 3. Hide Image for UI Capture
                    // We use a small delay and state change to ensure the DOM updates
                    setIsHidden(true); 
                    await new Promise(resolve => setTimeout(resolve, 150));

                    // 4. Capture UI Overlay (Text, Buttons, etc.)
                    const uiOptions = {
                        width: Math.ceil(rect.width),
                        height: Math.ceil(rect.height),
                        canvasWidth: targetWidth,
                        canvasHeight: targetHeight,
                        style: {
                            margin: 0,
                            transform: 'none',
                        },
                        skipAutoScale: true,
                        cacheBust: true,
                        pixelRatio: targetWidth / rect.width, // Explicit ratio
                        backgroundColor: 'transparent', // Ensure transparency
                        filter: (node) => {
                           // Exclude the background image layer entirely from html-to-image
                           if (node.classList?.contains('bg-layer')) return false;
                           // Exclude controls
                           if (node.classList?.contains('floating-controls')) return false;
                           if (node.classList?.contains('no-print')) return false;
                           // Exclude any other img tags that might be the background
                           if (node.tagName === 'IMG' && node.src === image) return false;
                           return true;
                        }
                    };

                    const uiBlob = await toPng(previewRef.current, uiOptions);
                    
                    // Show Image Again
                    setIsHidden(false);

                    // 5. Composite UI onto Canvas
                    if (uiBlob) {
                        const uiImg = await loadImage(uiBlob);
                        ctx.drawImage(uiImg, 0, 0, canvas.width, canvas.height);
                    }

                    // 6. Return Result
                    if (format === 'blob') {
                        return await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
                    } else {
                        return canvas.toDataURL('image/png');
                    }

                } catch (err) {
                    console.error(`Attempt ${attempts + 1} failed:`, err);
                    attempts++;
                    setIsHidden(false); // Ensure visible on fail
                    if (attempts >= maxAttempts) throw err;
                    await new Promise(r => setTimeout(r, 500)); // Wait before retry
                }
            }
        }

        const handleDownload = async () => {
          if (previewRef.current && image) {
            setIsDownloading(true);
            try {
              if (isIOS && navigator.share) {
                 const blob = await generateImage('blob');
                 if (blob) {
                    const file = new File([blob], `google-place-card-${Date.now()}.png`, { type: 'image/png' });
                    if (navigator.canShare && navigator.canShare({ files: [file] })) {
                        try {
                           await navigator.share({ files: [file] });
                        } catch (shareErr) {
                           // Ignore share cancellation
                        }
                    } else {
                        alert('Ïù¥ Í∏∞Í∏∞ÏóêÏÑúÎäî Í≥µÏú† Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏäµÎãàÎã§.');
                    }
                 } else {
                    alert('Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                 }
              } else {
                 const dataUrl = await generateImage('png');
                 const link = document.createElement('a');
                 link.download = `google-place-card-${Date.now()}.png`;
                 link.href = dataUrl;
                 link.click();
              }

            } catch (err) {
              console.error(err);
              alert('Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            } finally {
              setIsDownloading(false);
            }
          }
        };
        
        const theme = {
           bg: isDarkMode ? '#202124' : '#ffffff',
           textPrimary: isDarkMode ? '#e8eaed' : '#202124',
           textSecondary: isDarkMode ? '#9aa0a6' : '#70757A',
           iconColor: isDarkMode ? '#e8eaed' : '#3c4043',
           buttonBg: isDarkMode ? '#303134' : '#ffffff',
           buttonBorder: isDarkMode ? '#3c4043' : '#dadce0',
           buttonText: isDarkMode ? '#8ab4f8' : '#1a73e8',
           saveIconStroke: isDarkMode ? '#8ab4f8' : '#1a73e8',
           navFill: isDarkMode ? '#8ab4f8' : '#1a73e8',
           flagFill: isDarkMode ? '#8ab4f8' : '#1a73e8',
           starEmpty: isDarkMode ? '#5f6368' : '#E0E0E0'
        };

        return (
          <div className="min-h-screen bg-gray-50 font-sans text-gray-900 pb-20 lg:pb-10 lg:pt-10">
            <div className="max-w-md mx-auto p-4 flex flex-col gap-6 lg:max-w-6xl lg:flex-row lg:items-start lg:gap-10">
              
              {/* Left Column: Inputs */}
              <div className="flex flex-col gap-6 w-full lg:w-1/2">
                  <div className="flex items-center justify-between pt-2">
                    <h1 className="text-2xl font-bold tracking-tight">Íµ¨Í∏Ä ÏßÄÎèÑ Ìè¨ÌÜ† Ïπ¥Îìú üìç</h1>
                  </div>

                  <div>
                    <label className="block w-full h-24 bg-white border-2 border-dashed border-gray-200 rounded-2xl cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition-all flex flex-col items-center justify-center gap-2 group shadow-sm">
                        {image ? (
                           <div className="flex items-center gap-2">
                             <div className="w-10 h-10 rounded-lg overflow-hidden border border-gray-200">
                                <img src={image} className="w-full h-full object-cover" />
                             </div>
                             <span className="text-sm font-bold text-blue-600">ÏÇ¨ÏßÑ Î≥ÄÍ≤ΩÌïòÍ∏∞</span>
                           </div>
                        ) : (
                          <>
                            <div className="flex items-center gap-2">
                              <svg className="w-5 h-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2-2H6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                              <span className="text-sm font-semibold text-gray-500">Î∞∞Í≤Ω ÏÇ¨ÏßÑ ÏÑ†ÌÉù</span>
                            </div>
                          </>
                        )}
                        <input type="file" className="hidden" accept="image/*" onChange={handleImageUpload} />
                    </label>
                  </div>

                  <div className="bg-white p-5 rounded-[24px] shadow-sm border border-gray-100 space-y-5">
                       <div className="flex flex-col gap-3 pb-3 border-b border-gray-100">
                         <label className="text-xs font-semibold text-gray-500 ml-1">Ïπ¥Îìú Ïä§ÌÉÄÏùº ÏÑ§Ï†ï</label>
                         <div className="flex gap-2">
                            <button 
                              onClick={() => setIsDarkMode(!isDarkMode)}
                              className={`flex-1 h-10 rounded-lg flex items-center justify-center gap-2 text-sm font-medium transition-all ${isDarkMode ? 'bg-gray-800 text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}`}
                            >
                              {isDarkMode ? <Icons.Moon /> : <Icons.Sun />}
                              {isDarkMode ? 'Îã§ÌÅ¨ Î™®Îìú' : 'ÎùºÏù¥Ìä∏ Î™®Îìú'}
                            </button>
                         </div>
                         
                         <div className="flex bg-gray-100 rounded-lg p-1">
                            {[
                              { val: '9/16', label: 'Ïä§ÌÜ†Î¶¨' },
                              { val: '4/5', label: 'ÌîºÎìú' },
                              { val: '1/1', label: 'Ï†ïÏÇ¨Í∞ÅÌòï' }
                            ].map((opt) => (
                               <button
                                 key={opt.val}
                                 onClick={() => setAspectRatio(opt.val)}
                                 className={`flex-1 h-8 rounded-md text-xs font-bold transition-all ${aspectRatio === opt.val ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-400 hover:text-gray-600'}`}
                               >
                                 {opt.label}
                               </button>
                            ))}
                         </div>
                       </div>

                       <div className="flex flex-col gap-1.5">
                         <label className="text-xs font-semibold text-gray-500 ml-1">Ïû•ÏÜå Ïù¥Î¶Ñ & Ïù∏Ï¶ù</label>
                         <div className="flex items-center gap-2">
                            <input
                              type="text"
                              value={locationName}
                              onChange={(e) => setLocationName(e.target.value)}
                              placeholder="Ïòà: Ïö∞Î¶¨Ïßë"
                              className="flex-1 h-12 px-4 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:bg-white focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all text-gray-900 placeholder-gray-400"
                            />
                            <button 
                              onClick={() => setIsVerified(!isVerified)}
                              className={`w-12 h-12 rounded-xl border flex items-center justify-center transition-all ${isVerified ? 'bg-blue-50 border-blue-200' : 'bg-gray-50 border-gray-200 grayscale opacity-60'}`}
                            >
                               <Icons.BlueCheck />
                            </button>
                         </div>
                       </div>
                       
                       <div>
                         <style>{`
                             .custom-range::-webkit-slider-thumb {
                               -webkit-appearance: none;
                               appearance: none;
                               width: 24px;
                               height: 24px;
                               border-radius: 50%;
                               background: #ffffff;
                               cursor: pointer;
                               box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                               border: 1px solid #e5e7eb;
                               margin-top: -8px;
                             }
                             .custom-range::-webkit-slider-runnable-track {
                               width: 100%;
                               height: 8px;
                               cursor: pointer;
                               border-radius: 9999px;
                             }
                         `}</style>
                         <div className="flex justify-between items-end mb-2 px-1">
                             <label className="text-xs font-semibold text-gray-500">Î≥ÑÏ†ê</label>
                             <span className="text-lg font-bold text-blue-600">{rating}</span>
                         </div>
                         <div className="relative w-full">
                           <input 
                             type="range" 
                             min="0" max="5" step="0.5" 
                             value={rating} 
                             onChange={handleRatingChange}
                             className="custom-range w-full h-2 rounded-lg appearance-none cursor-pointer focus:outline-none"
                             style={{
                               background: `linear-gradient(to right, #1a73e8 0%, #1a73e8 ${(parseFloat(rating)/5)*100}%, #e5e7eb ${(parseFloat(rating)/5)*100}%, #e5e7eb 100%)`
                             }}
                           />
                           <div className="flex justify-between text-[10px] text-gray-400 mt-2 font-medium px-0.5">
                               <span>0.0</span>
                               <span>1.0</span>
                               <span>2.0</span>
                               <span>3.0</span>
                               <span>4.0</span>
                               <span>5.0</span>
                           </div>
                         </div>
                       </div>

                       <InputField 
                         label="Î¶¨Î∑∞ Ïàò" 
                         value={reviewCount} 
                         onChange={handleReviewCountChange} 
                         placeholder=""
                       />

                       <InputField 
                         label="ÏÑ§Î™Ö ÎòêÎäî Ï£ºÏÜå" 
                         value={description} 
                         onChange={(e) => setDescription(e.target.value)} 
                         placeholder=""
                       />
                       
                       <div className="flex flex-col gap-1.5">
                          <label className="text-xs font-semibold text-gray-500 ml-1">Í±∞Î¶¨ Ï†ïÎ≥¥</label>
                          <div className="flex gap-2">
                             <input
                               type="text"
                               value={distValue}
                               onChange={handleDistChange}
                               placeholder="Í±∞Î¶¨ (Ïà´Ïûê)"
                               className="flex-1 h-12 px-4 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:bg-white focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all text-gray-900 placeholder-gray-400 text-right"
                             />
                             <div className="relative w-1/3 min-w-[120px]">
                                <select 
                                  value={distUnit} 
                                  onChange={(e) => setDistUnit(e.target.value)}
                                  className="w-full h-12 px-4 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:bg-white focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all text-gray-900 appearance-none font-medium"
                                >
                                   {distUnits.map(unit => (
                                     <option key={unit} value={unit}>{unit}</option>
                                   ))}
                                </select>
                                <div className="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500">
                                   <svg width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                                     <path d="M1 1L5 5L9 1" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
                                   </svg>
                                </div>
                             </div>
                          </div>
                       </div>
                  </div>
              </div>

              {/* Right Column: Preview */}
              <div className="flex flex-col gap-3 w-full lg:w-1/2 lg:sticky lg:top-8">
                 <h2 className="text-lg font-bold text-gray-900 px-1 mt-4 lg:mt-0">ÎØ∏Î¶¨Î≥¥Í∏∞</h2>
                 <p className="text-xs text-gray-500 px-1 -mt-2 mb-1">Ïö∞Ï∏° ÌïòÎã® Î≤ÑÌäºÏúºÎ°ú ÏÇ¨ÏßÑ ÏúÑÏπòÎ•º Ï°∞Ï†àÌïòÏÑ∏Ïöî</p>
                 
                 <div className="w-full">
                   <div 
                     ref={previewRef}
                     className="relative overflow-hidden shadow-2xl mx-auto transition-colors duration-300"
                     style={{
                       width: '100%',
                       aspectRatio: aspectRatio,
                       maxWidth: '400px',
                       backgroundColor: theme.bg
                     }}
                   >
                       {!image ? (
                          <div className="absolute inset-0 z-0 flex flex-col items-center justify-center bg-gray-100 text-gray-400">
                            <span className="text-sm font-medium">ÏÇ¨ÏßÑÏùÑ ÏóÖÎ°úÎìúÌïòÎ©¥<br/>Ïó¨Í∏∞Ïóê ÎÇòÌÉÄÎÇ©ÎãàÎã§</span>
                          </div>
                       ) : (
                         <div 
                            ref={imgContainerRef}
                            className={`absolute inset-0 overflow-hidden ${isHidden ? 'hidden' : 'block'}`}
                            style={{ backgroundColor: theme.bg }}
                         >
                            <img 
                              src={image} 
                              alt="preview"
                              crossOrigin="anonymous" 
                              className="bg-layer pointer-events-none select-none"
                              style={{
                                position: 'absolute',
                                left: '50%',
                                top: '50%',
                                transform: `translate(calc(-50% + ${imgPos.x}px), calc(-50% + ${imgPos.y}px)) scale(${imgScale})`,
                                minWidth: '100%',
                                minHeight: '100%',
                                maxWidth: 'none',
                                objectFit: 'contain',
                                transition: 'transform 0.1s ease-out'
                              }}
                            />
                         </div>
                       )}

                       {/* New 3x3 Grid Controls */}
                       {image && !isHidden && (
                          <div className="floating-controls absolute bottom-[220px] right-3 z-40 animate-fade-in pointer-events-auto flex flex-col gap-2 items-end">
                             {/* Zoom Controls */}
                            <div className="bg-black/40 backdrop-blur-md rounded-full p-1 border border-white/10 flex flex-col items-center gap-1 shadow-lg w-10">
                              <button onClick={handleZoomIn} className="w-8 h-8 flex items-center justify-center rounded-full bg-white/10 text-white hover:bg-white/20 active:scale-90 transition-all">
                                <Icons.ZoomIn />
                              </button>
                              <span className="text-[10px] font-bold text-white text-center">{imgScale.toFixed(1)}</span>
                              <button onClick={handleZoomOut} className="w-8 h-8 flex items-center justify-center rounded-full bg-white/10 text-white hover:bg-white/20 active:scale-90 transition-all">
                                <Icons.ZoomOut />
                              </button>
                            </div>

                            {/* 3x3 Grid Controls (Replacing D-Pad) */}
                            <div className="bg-black/40 backdrop-blur-md rounded-2xl p-1.5 border border-white/10 shadow-lg grid grid-cols-3 gap-1 w-[100px]">
                               {/* Row 1 */}
                               <button onClick={() => handleAlign(OFFSET, OFFSET)} className="w-7 h-7 flex items-center justify-center rounded bg-white/10 hover:bg-white/20 active:bg-white/30 transition-all group">
                                  <div className="w-2 h-2 border-t-2 border-l-2 border-white opacity-80 group-hover:opacity-100"></div>
                               </button>
                               <button onClick={() => handleAlign(0, OFFSET)} className="w-7 h-7 flex items-center justify-center rounded bg-white/10 hover:bg-white/20 active:bg-white/30 transition-all group">
                                  <div className="w-2 h-2 border-t-2 border-white opacity-80 group-hover:opacity-100"></div>
                               </button>
                               <button onClick={() => handleAlign(-OFFSET, OFFSET)} className="w-7 h-7 flex items-center justify-center rounded bg-white/10 hover:bg-white/20 active:bg-white/30 transition-all group">
                                  <div className="w-2 h-2 border-t-2 border-r-2 border-white opacity-80 group-hover:opacity-100"></div>
                               </button>

                               {/* Row 2 */}
                               <button onClick={() => handleAlign(OFFSET, 0)} className="w-7 h-7 flex items-center justify-center rounded bg-white/10 hover:bg-white/20 active:bg-white/30 transition-all group">
                                  <div className="w-2 h-2 border-l-2 border-white opacity-80 group-hover:opacity-100"></div>
                               </button>
                               <button onClick={() => handleAlign(0, 0)} className="w-7 h-7 flex items-center justify-center rounded bg-white/20 hover:bg-white/30 active:bg-white/40 transition-all group">
                                  <div className="w-1.5 h-1.5 bg-white rounded-full opacity-90 group-hover:opacity-100 shadow-[0_0_4px_rgba(255,255,255,0.5)]"></div>
                               </button>
                               <button onClick={() => handleAlign(-OFFSET, 0)} className="w-7 h-7 flex items-center justify-center rounded bg-white/10 hover:bg-white/20 active:bg-white/30 transition-all group">
                                  <div className="w-2 h-2 border-r-2 border-white opacity-80 group-hover:opacity-100"></div>
                               </button>

                               {/* Row 3 */}
                               <button onClick={() => handleAlign(OFFSET, -OFFSET)} className="w-7 h-7 flex items-center justify-center rounded bg-white/10 hover:bg-white/20 active:bg-white/30 transition-all group">
                                  <div className="w-2 h-2 border-b-2 border-l-2 border-white opacity-80 group-hover:opacity-100"></div>
                               </button>
                               <button onClick={() => handleAlign(0, -OFFSET)} className="w-7 h-7 flex items-center justify-center rounded bg-white/10 hover:bg-white/20 active:bg-white/30 transition-all group">
                                  <div className="w-2 h-2 border-b-2 border-white opacity-80 group-hover:opacity-100"></div>
                               </button>
                               <button onClick={() => handleAlign(-OFFSET, -OFFSET)} className="w-7 h-7 flex items-center justify-center rounded bg-white/10 hover:bg-white/20 active:bg-white/30 transition-all group">
                                  <div className="w-2 h-2 border-b-2 border-r-2 border-white opacity-80 group-hover:opacity-100"></div>
                               </button>
                            </div>
                          </div>
                       )}

                       <div className="absolute top-0 left-0 right-0 p-4 z-20 flex justify-between items-start pt-6 gap-5 pr-1 pointer-events-none">
                         <button className="w-10 h-10 rounded-full flex items-center justify-center transition-colors pointer-events-auto hover:bg-black/10 backdrop-blur-[2px]">
                           <Icons.Back />
                         </button>
                         <div className="flex gap-2">
                           <button className="w-10 h-10 rounded-full flex items-center justify-center transition-colors pointer-events-auto hover:bg-black/10 backdrop-blur-[2px]">
                             <Icons.ShareWhite />
                           </button>
                           <button className="w-10 h-10 rounded-full flex items-center justify-center transition-colors pointer-events-auto hover:bg-black/10 backdrop-blur-[2px]">
                             <Icons.More />
                           </button>
                         </div>
                       </div>

                       <div className="absolute bottom-[32%] left-5 z-20 pointer-events-none">
                         <div className="opacity-80">
                           <Icons.GoogleLogo />
                         </div>
                       </div>

                       <div className="absolute bottom-0 left-0 right-0 z-30 pointer-events-auto">
                         <div 
                           className="w-full rounded-t-[24px] pb-5 pt-2 shadow-[0_-4px_24px_rgba(0,0,0,0.12)] transition-colors duration-300"
                           style={{ backgroundColor: theme.bg }}
                         >
                           <div className="w-full flex justify-center pt-2 pb-1">
                             <div className="w-9 h-1 bg-gray-300 rounded-full opacity-50"></div>
                           </div>

                           <div className="px-5">
                             <div className="flex justify-between items-start mt-2">
                               <div className="flex items-center gap-1.5 max-w-[70%]">
                                 <h2 
                                   className="text-[26px] font-bold leading-tight break-words tracking-tight"
                                   style={{ color: theme.textPrimary }}
                                 >
                                   {locationName || 'Ïû•ÏÜå Ïù¥Î¶Ñ'}
                                 </h2>
                                 {isVerified && (
                                   <div className="min-w-[18px] pt-1">
                                     <Icons.BlueCheck />
                                   </div>
                                 )}
                               </div>
                               <div className="flex gap-4 pr-1 mt-1">
                                  <Icons.Bookmark color={theme.iconColor} />
                                  <Icons.Share color={theme.iconColor} />
                                  <Icons.Close color={theme.iconColor} />
                               </div>
                             </div>

                             <div className="flex items-center gap-1 mt-2">
                               <span className="text-sm font-medium" style={{ color: theme.textPrimary }}>{rating}</span>
                               <div className="flex items-center gap-[1px]">
                                 {[1, 2, 3, 4, 5].map((star) => (
                                   <span key={star}>
                                     {parseFloat(rating) >= star ? <Icons.StarFull /> : <Icons.StarEmpty color={theme.starEmpty} />}
                                   </span>
                                 ))}
                               </div>
                               <span className="text-sm ml-1" style={{ color: theme.textSecondary }}>
                                 ({reviewCount ? reviewCount : '0'})
                               </span>
                             </div>

                             <div className="mt-1 text-sm leading-relaxed" style={{ color: theme.textSecondary }}>
                               {description || 'Ïû•ÏÜå ÏÑ§Î™Ö ÎòêÎäî Ï£ºÏÜå'}
                             </div>

                             <div className="mt-1 text-sm leading-relaxed" style={{ color: theme.textSecondary }}>
                               {distValue ? `${distValue} ${distUnit}` : 'Í±∞Î¶¨ Ï†ïÎ≥¥'}
                             </div>

                             <div className="flex gap-3 mt-4 overflow-x-auto no-scrollbar pb-1">
                               <button 
                                 className="flex items-center gap-1.5 px-5 py-2.5 rounded-full text-sm font-medium whitespace-nowrap shadow-none border border-transparent"
                                 style={{ backgroundColor: theme.navFill, color: '#fff' }}
                               >
                                 <Icons.Direction />
                                 Í≤ΩÎ°ú
                               </button>
                               <button 
                                 className="flex items-center gap-1.5 px-5 py-2.5 rounded-full text-sm font-medium whitespace-nowrap border"
                                 style={{ backgroundColor: theme.buttonBg, borderColor: theme.buttonBorder, color: theme.buttonText }}
                               >
                                 <Icons.Navigation color={theme.buttonText} />
                                 ÏãúÏûë
                               </button>
                               <button 
                                 className="flex items-center gap-1.5 px-5 py-2.5 rounded-full text-sm font-medium whitespace-nowrap border"
                                 style={{ backgroundColor: theme.buttonBg, borderColor: theme.buttonBorder, color: theme.buttonText }}
                               >
                                 <Icons.Save stroke={theme.saveIconStroke} />
                                 Ï†ÄÏû•
                               </button>
                               <button 
                                 className="flex items-center gap-1.5 px-5 py-2.5 rounded-full text-sm font-medium whitespace-nowrap border"
                                 style={{ backgroundColor: theme.buttonBg, borderColor: theme.buttonBorder, color: theme.buttonText }}
                               >
                                 <Icons.Flag color={theme.flagFill} />
                                 ÎùºÎ≤® Ï∂îÍ∞Ä
                               </button>
                             </div>
                           </div>
                         </div>
                       </div>
                  </div>
                 </div>

                 <div className="flex gap-2 mt-2 mb-10 w-full max-w-[400px] mx-auto">
                   <button 
                      onClick={handleDownload}
                      disabled={!image || isDownloading}
                      className="flex-1 h-14 bg-black text-white rounded-2xl font-bold text-lg hover:bg-gray-800 disabled:bg-gray-200 disabled:text-gray-400 transition-all flex items-center justify-center gap-2 shadow-lg"
                    >
                      {isDownloading ? 'Ï≤òÎ¶¨ Ï§ë...' : (isIOS ? 'Í≥µÏú†ÌïòÍ∏∞' : 'Ï†ÄÏû•ÌïòÍ∏∞')}
                   </button>
                 </div>
              </div>
            </div>
          </div>
        );
      };

      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
